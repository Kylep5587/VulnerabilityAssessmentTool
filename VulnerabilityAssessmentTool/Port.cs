/*****************************************
 * VAT - CIS470 Senior Project           *
 * Port.cs                               *
 * Provides template for port data and   *
 *  methods for accessing port info      *
 *  *************************************/

using System;
using System.Collections.Generic;
using System.Data.OleDb;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace VulnerabilityAssessmentTool
{
    class Port
    {
        private DatabaseHelper db = new DatabaseHelper();

        // Members
        private int portNumber;
        private string protocol;
        private string description;


        // Getters and setters
        public int PortNumber { get => portNumber; set => portNumber = value; }
        public string Protocol { get => protocol; set => protocol = value; }
        public string Description { get => description; set => description = value; }


        /* Gets the current active ports stored in the database
         * ********************************************/
        public List<Port> GetPortList()
        {
            List<Port> portList = new List<Port>(); // List to store port objects in
            string query = "SELECT * FROM PortScanResults";
            OleDbCommand cmd = new OleDbCommand(query, db.conn);
            OleDbDataReader dr = cmd.ExecuteReader();

            while (dr.Read())   // Loop through results
            {
                Port activePort = new Port
                {
                    // Assign data to object variables
                    PortNumber = Convert.ToInt16(dr["PortNumber"]),
                    Protocol = dr["Protocol"].ToString(),
                    Description = dr["Description"].ToString()
                };  

                portList.Add(activePort);                               // Add vulnerability object to list
            }

            return portList;
        }
    }
}
