/*****************************************
 * VAT - CIS470 Senior Project           *
 * SoftwareScan.cs                       *
 * Provides email breach template and    *
 *  methods for accessing breach info    *
 *  *************************************/

using System;
using System.Collections.Generic;
using System.Data.OleDb;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace VulnerabilityAssessmentTool
{
    class EmailBreach
    {
        private DatabaseHelper db = new DatabaseHelper();

        // Members 
        private int id;
        private string emailAddress;
        private string breachName;
        private string breachTitle;
        private string breachDomain;
        private string breachDate;
        private string addedDate;
        private string modifiedDate;
        private int pwnCount;
        private string description;
        private string dataClasses;
        private bool isVerified;
        private bool isSensitive;
        private bool isRetired;
        private bool isSpamList;


        // Getters and setters
        public int Id { get => id; set => id = value; }
        public string EmailAddress { get => emailAddress; set => emailAddress = value; }
        public string BreachName { get => breachName; set => breachName = value; }
        public string BreachTitle { get => breachTitle; set => breachTitle = value; }
        public string BreachDomain { get => breachDomain; set => breachDomain = value; }
        public string AddedDate { get => addedDate; set => addedDate = value; }
        public string ModifiedDate { get => modifiedDate; set => modifiedDate = value; }
        public int PwnCount { get => pwnCount; set => pwnCount = value; }
        public string Description { get => description; set => description = value; }
        public string DataClasses { get => dataClasses; set => dataClasses = value; }
        public bool IsVerified { get => isVerified; set => isVerified = value; }
        public bool IsSensitive { get => isSensitive; set => isSensitive = value; }
        public bool IsRetired { get => isRetired; set => isRetired = value; }
        public bool IsSpamList { get => isSpamList; set => isSpamList = value; }
        public string BreachDate { get => breachDate; set => breachDate = value; }


        /* Gets the current breach data stored in the database
         * ********************************************/
        public List<EmailBreach> GetBreachList()
        {
            List<EmailBreach> breachList = new List<EmailBreach>(); // List to store port objects in
            string query = "SELECT * FROM HaveIBeenPwned";
            OleDbCommand cmd = new OleDbCommand(query, db.conn);
            OleDbDataReader dr = cmd.ExecuteReader();

            while (dr.Read())   // Loop through results
            {
                EmailBreach breach = new EmailBreach
                {
                    // Assign data to object variables
                    Id = Convert.ToInt16(dr["ID"]),
                    BreachName = dr["BreachName"].ToString(),
                    BreachTitle = dr["BreachTitle"].ToString(),
                    BreachDomain = dr["BreachDomain"].ToString(),
                    BreachDate = dr["BreachDate"].ToString(),
                    AddedDate = dr["AddedDate"].ToString(),
                    modifiedDate = dr["ModifiedDate"].ToString(),
                    PwnCount = Convert.ToInt16(dr["PwnCount"]),
                    Description = dr["Description"].ToString(),
                    DataClasses = dr["DataClasses"].ToString(),
                    IsVerified = Convert.ToBoolean(dr["IsVerified"]),
                    IsSensitive = Convert.ToBoolean(dr["IsSensitive"]),
                    IsRetired = Convert.ToBoolean(dr["IsRetired"]),
                    IsSpamList = Convert.ToBoolean(dr["IsSpamList"])
                };  

                breachList.Add(breach);  // Add object to list
            }

            return breachList;
        }
    }
}
